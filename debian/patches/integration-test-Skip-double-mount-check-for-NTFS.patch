From cf93824e79e02ff62f16eb0fab24d5574612e395 Mon Sep 17 00:00:00 2001
From: Martin Pitt <martin.pitt@ubuntu.com>
Date: Thu, 18 Dec 2014 13:40:07 +0100
Subject: [PATCH] integration-test: Skip double mount check for NTFS

ntfs-3g does not support multiple mounts.
---
 src/tests/integration-test | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/tests/integration-test b/src/tests/integration-test
index e8a67b9..9ccd65a 100755
--- a/src/tests/integration-test
+++ b/src/tests/integration-test
@@ -884,12 +884,16 @@ class FS(UDisksTestCase):
             return
         self.assertEqual(ret, 0)
 
-        subprocess.check_call([mount_prog, self.device, mount_b])
+        self.assertProperty(fs, 'mount-points', [mount_a])
 
-        self.assertProperty(fs, 'mount-points', [mount_a, mount_b])
+        if type != 'ntfs':
+            # ntfs-3g does not support multiple mounts
+            subprocess.check_call([mount_prog, self.device, mount_b])
+            self.assertProperty(fs, 'mount-points', [mount_a, mount_b])
+            subprocess.call(['umount', mount_b])
 
         # unmount it
-        subprocess.call(['umount', mount_a, mount_b])
+        subprocess.call(['umount', mount_a])
         self.assertProperty(fs, 'mount-points', [])
 
     def _do_udisks_check(self, type, label=None):
-- 
2.1.3

